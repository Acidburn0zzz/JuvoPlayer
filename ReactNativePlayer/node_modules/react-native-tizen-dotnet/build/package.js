'use strict';

var _fsExtra = require('fs-extra');

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _crypto = require('crypto');

var _crypto2 = _interopRequireDefault(_crypto);

var _child_process = require('child_process');

var _utlis = require('./utlis');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @flow
var llog = function llog(str) {
    return (0, _utlis._log)('Package', 'INFO', str);
};

(function packagerBuild() {

    llog('Command: build project with dotnet SDK');

    var dotnetPath = _utlis.appPath + '/Tizen';
    llog('Tizen dotnet Project Path: ' + dotnetPath);

    //check tizen.dll hash
    checkHash(_fsExtra2.default.readFileSync((0, _utlis.format)(_utlis.appPath + '/Tizen/ReactNativeTizen.dll')));

    function checkHash(data) {
        var sha1 = _crypto2.default.createHash('sha1');
        sha1.update(data);
        var hash = sha1.digest('hex');
        llog('local ReactNativeTizen.dll sha1 hash check: ' + hash);
        llog('The latest version of ReactNativeTizen.dll is e295ff62c9aa2bd0cc8aca188e206e3b2a82f985');
    }

    var mode = _utlis.config.mode;

    //dotnet build

    var SPACE = ' ';
    (0, _child_process.execSync)('dotnet restore ' + SPACE + (0, _utlis.format)('' + dotnetPath), { stdio: [0, 1, 2] });

    (0, _child_process.execSync)('dotnet build -c ' + mode + SPACE + (0, _utlis.format)('' + dotnetPath), { stdio: [0, 1, 2] });
})();